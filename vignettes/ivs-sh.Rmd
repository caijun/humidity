---
title: "Regression of Influenza A Virus Survival on Specific Humidity"
author: "Jun Cai <cai-j12@mails.tsinghua.edu.cn>"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
bibliography: bibliography.bib
link-citations: yes
vignette: >
  %\VignetteIndexEntry{Regression of Influenza Virus Survival on Specific Humidity}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

@Harper1961 tested airborne virus particles of influenza A for viable survival in the dark at controlled temperature and relative humidity for up to 23 hour after spraying. The 1-h influenza A virus survival data are extracted from the paper and now are stored in **humidity** pacakge with a dataset name of `ivs`. In this vignette, the dataset `ivs` is used to explore the relationship between influenza A virus survival and specific humidity. As specific humidity isn't provided, we first need to apply functions from **humidity** package to calculate specific humidity from temperature and relative humidity.

```{r}
# load humidity package
library(humidity)

# display built-in 1-h influenza virus surival data
head(ivs)
```

As the temperature `T` is recorded in degree Celsius (Â°C), we first apply `C2K` function to convert the temperature into Kelvin (K) before our following calculation. We then call `SVP` and `WVP` functions to calculate saturation vapor pressure $e_s$ (hPa) and partial water vapor pressure $e$ (Pa) at temperature $T$, respectively. Finally by calling `AH`, `SH`, and `MR` functions, we can calculate humidity measures of interest, such as absolute humidity $\rho_w$ (kg/m^3), specific humidity $q$ (kg/kg), and mixing ratio $\omega$ (kg/kg).

Note that `SVP` function provides two formulas (either **Clausius-Clapeyron equation** or **Murray equation**) for calculating saturation vapor pressure. Both results are the same and the default `formula` is `Clausius-Clapeyron`, which is consistent with @Shaman2009. Furthermore, @Harper1961 didn't give any information on the atmospheric pressure condition under which his experiments were conducted. We just assume that he performed the experiments under standard atmospheric pressure and the default value of `p = 101325` Pa is used in `SH` function when calculating specific humidity.
```{r, message=FALSE}
library(tidyverse)
ivs <- ivs %>% 
  mutate(Tk = C2K(T), # tempature in Kelvin
         Es = SVP(Tk), # saturation vapor pressure in hPa
         E = WVP2(RH, Es), # partial water vapor pressure in Pa
         rho = AH(E, Tk), # absolute humidity in kg/m^3
         q = SH(E), # specific humidity in kg/kg
         omega = MR(q), # mixing ratio in kg/kg
         )
# display calculation results
head(ivs)
```

Hinted by @Shaman2009 and @Shaman2010, *log-linear* regression model is applied to describe the relationship between influenza A virus survival and specific humidity.
```{r}
# log-linear regression of 1-h infuenza A virus survival on specific humididty
loglm <- lm(log(PVV) ~ q, data = ivs)
summary(loglm)
```
The regression coefficient of specific humidity $q$ is significant with a $p$-value less than 0.0001, indicating that log-linear model can well depict the association of influenza virus survival with specific humidity. But the coefficient estimate for specific humidity $q$ is `r round(coef(loglm)[2], 4)`, which is too far from the value of $a = -180$ estimated by @Shaman2010.

The following codes draw the scatter plot of 1-h influenza A virus survival and specific humidity, with regression curve overlapped.

```{r, fig.width=5.5, fig.height=5.5, fig.align='center'}
# get fitted value to plot regression curve
ivs$fit.val <- exp(predict(loglm))
ivs <- ivs[with(ivs, order(q)), ]

# plot percentage viable virus vs. specific humidity
par(pty = "s")
plot(x = ivs$q, y = ivs$PVV, col = "red", pch = 3, lwd = 3, 
     xaxt = "n", yaxt = "n", xlim = c(0, 0.03), ylim = c(0, 100), 
     xaxs = "i", yaxs = "i", xlab = "", ylab = "", 
     main = "Regression of Influenza A Virus Survival\n on Specific Humidity")
title(xlab = "Specific Humidity (kg/kg)", ylab = "Percent  Viable (%)", mgp = c(2, 1, 0))
# plot regression curve
lines(x = ivs$q, y = ivs$fit.val, lty = "dashed", lwd = 4)
axis(side = 1, at = seq(0, 0.03, by = 0.01), labels = c("0", "0.01", "0.02", "0.03"), 
     tck = 0.01, padj = -0.5)
axis(side = 2, at = seq(0, 100, by = 20), tck = 0.01, las = 2, hadj = 0.5)
axis(side = 3, at = seq(0, 0.03, by = 0.01), labels = FALSE, tck = 0.01)
axis(side = 4, at = seq(0, 100, by = 20), labels = FALSE, tck = 0.01)
legend(0.011, 95, legend = c("1 Hour Viability", "p < 0.0001"), pch = c(3, NA), 
       col = c("red", "black"), lty = c(NA, "dashed"), lwd = c(3, 4), seg.len = 5)
```
The codes also reproduce the Figure 1.(B) of @Shaman2010.

## References
